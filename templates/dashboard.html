{% extends "base.html" %} {% block content %}

<!-- Dashboard Heading -->
<h2 class="text-center">Employee Dashboard</h2>

<!-- Table container for responsiveness and styling -->
<div class="table-container">
  <table id="employeeTable">
    <thead>
      <tr>
        <!-- Sortable columns (click to sort using JavaScript function) -->
        <th onclick="sortTable(0)">Name ⬍</th>
        <th>Email</th>
        <th>Position</th>
        <th onclick="sortTable(3)">Salary ⬍</th>
        <th>Address</th>
        <th onclick="sortTable(5)">Joining Date ⬍</th>
        <th onclick="sortTable(6)">End Date ⬍</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Loop through all employees from backend -->
      {% for emp in employees %}
      <tr>
        <td>{{ emp.name }}</td>
        <td>{{ emp.email }}</td>
        <td>{{ emp.position }}</td>
        <td>{{ emp.salary }}</td>
        <td>{{ emp.address }}</td>
        <td>{{ emp.joining_date }}</td>
        <!-- Show "-" if end_date is not set -->
        <td>{{ emp.end_date if emp.end_date else '-' }}</td>
        <td>
          <!-- Edit & Delete links for each employee -->
          <a href="{{ url_for('update_employee', id=emp.id) }}">Edit</a> |
          <a
            href="{{ url_for('delete_employee', id=emp.id) }}"
            onclick="return confirm('Are you sure you want to delete this employee?');"
            >Delete</a
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Button to add a new employee -->
<a href="{{ url_for('add_employee') }}" class="btn">Add Employee</a>

<!-- JavaScript function to sort table by column -->
<script>
  function sortTable(colIndex) {
    let table = document.getElementById("employeeTable");
    let rows = Array.from(table.rows).slice(1); // Get all rows except header
    let asc = table.getAttribute("data-sort-asc") === "true"; // Toggle sorting order

    rows.sort((a, b) => {
      let valA = a.cells[colIndex].innerText.trim();
      let valB = b.cells[colIndex].innerText.trim();

      // If values are numbers, sort numerically
      if (!isNaN(valA) && !isNaN(valB)) {
        return asc ? valA - valB : valB - valA;
      }

      // If values are dates, sort by date
      if (Date.parse(valA) && Date.parse(valB)) {
        return asc
          ? new Date(valA) - new Date(valB)
          : new Date(valB) - new Date(valA);
      }

      // Otherwise, sort alphabetically (string comparison)
      return asc ? valA.localeCompare(valB) : valB.localeCompare(valA);
    });

    // Re-append sorted rows to table
    rows.forEach((row) => table.tBodies[0].appendChild(row));

    // Toggle sorting order for next click
    table.setAttribute("data-sort-asc", !asc);
  }
</script>

{% endblock %}
